<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FastAPI To-Do List</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
  <h2 class="mb-4">To-Do List</h2>
  <form id="todoForm" class="mb-4">
    <input type="hidden" id="todoId">
    <div class="mb-2">
      <input type="text" id="student_name" class="form-control" placeholder="Student Name" required>
    </div>
    <div class="mb-2">
      <input type="text" id="task" class="form-control" placeholder="Task" required>
    </div>
    <button type="submit" class="btn btn-primary" id="saveBtn">Add To-Do</button>
    <button type="button" class="btn btn-secondary" id="cancelBtn" style="display:none;">Cancel</button>
  </form>
  <table class="table">
    <thead>
      <tr><th>ID</th><th>Student Name</th><th>Task</th><th>Actions</th></tr>
    </thead>
    <tbody id="todoTableBody"></tbody>
  </table>
</div>

<script>
const API_URL = "https://your-fastapi-render-url.onrender.com/todos"; // Change after deploy!

const todoForm = document.getElementById("todoForm");
const todoTable = document.getElementById("todoTableBody");
const studentNameInput = document.getElementById("student_name");
const taskInput = document.getElementById("task");
const todoIdInput = document.getElementById("todoId");
const saveBtn = document.getElementById("saveBtn");
const cancelBtn = document.getElementById("cancelBtn");

function fetchTodos() {
  fetch(API_URL)
    .then(res => res.json())
    .then(todos => {
      todoTable.innerHTML = "";
      todos.forEach(todo => {
        addTodoRow(todo);
      });
    });
}

function addTodoRow(todo) {
  const tr = document.createElement("tr");
  tr.innerHTML = `
    <td>${todo.id}</td>
    <td>${todo.student_name}</td>
    <td>${todo.task}</td>
    <td>
      <button onclick='editTodo(${todo.id})' class='btn btn-warning btn-sm'>Edit</button>
      <button onclick='deleteTodo(${todo.id})' class='btn btn-danger btn-sm'>Delete</button>
    </td>
  `;
  todoTable.appendChild(tr);
}

todoForm.onsubmit = function (e) {
  e.preventDefault();
  const todo = {
    student_name: studentNameInput.value.trim(),
    task: taskInput.value.trim(),
  };
  const id = todoIdInput.value;
  if (id) {
    fetch(`${API_URL}/${id}`, {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(todo)
    }).then(() => {
      fetchTodos();
      resetForm();
    });
  } else {
    fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(todo)
    }).then(() => {
      fetchTodos();
      resetForm();
    });
  }
};

window.editTodo = function(id) {
  fetch(`${API_URL}/${id}`)
    .then(res => res.json())
    .then(todo => {
      todoIdInput.value = todo.id;
      studentNameInput.value = todo.student_name;
      taskInput.value = todo.task;
      saveBtn.textContent = "Update To-Do";
      cancelBtn.style.display = "inline-block";
    });
};

window.deleteTodo = function(id) {
  if (confirm("Delete this to-do?")) {
    fetch(`${API_URL}/${id}`, { method: "DELETE" })
      .then(() => fetchTodos());
  }
};

cancelBtn.onclick = function () {
  resetForm();
};

function resetForm() {
  todoIdInput.value = "";
  studentNameInput.value = "";
  taskInput.value = "";
  saveBtn.textContent = "Add To-Do";
  cancelBtn.style.display = "none";
}

fetchTodos();
</script>
</body>
</html>
